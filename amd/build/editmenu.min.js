define(["core/log","core/ajax"],function(e,o){"use strict";function t(){}return t.prototype.main=function(){for(var e=this,t=document.querySelectorAll(".nested-sortable.list-move"),i=0;i<t.length;i++)new Sortable(t[i],{group:{name:"nestedmenu",pull:!0},animation:150,fallbackOnBody:!0,swapThreshold:.65,ghostClass:"reordering",onStart:e.SortStart,onEnd:e.SortEnd});for(var a=document.querySelectorAll(".nested-sortable.list-clone"),i=0;i<a.length;i++)new Sortable(a[i],{group:{name:"nestedmenu",pull:"clone"},animation:150,fallbackOnBody:!0,swapThreshold:.65,ghostClass:"reordering",onStart:e.SortStart,onEnd:e.SortEnd});document.querySelectorAll(".visibility-visible").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),o.call([{methodname:"mod_website_apicontrol",args:{action:"page_visibility",data:JSON.stringify({pageid:t.dataset.pageid,hidden:1})}}]),document.querySelectorAll('.list-group-item[data-pageid="'+t.dataset.pageid+'"]').forEach(e=>{e.dataset.hidden=1})})}),document.querySelectorAll(".visibility-hidden").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),o.call([{methodname:"mod_website_apicontrol",args:{action:"page_visibility",data:JSON.stringify({pageid:t.dataset.pageid,hidden:0})}}]),document.querySelectorAll('.list-group-item[data-pageid="'+t.dataset.pageid+'"]').forEach(e=>{e.dataset.hidden=0})})}),document.querySelectorAll(".promote-to-homepage").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),o.call([{methodname:"mod_website_apicontrol",args:{action:"promotetohome",data:t.dataset.pageid},done:function(e){document.querySelectorAll('.list-group-item[data-ishomepage="1"]').forEach(e=>{e.dataset.ishomepage=0}),document.querySelectorAll('.list-group-item[data-pageid="'+t.dataset.pageid+'"]').forEach(e=>{e.dataset.ishomepage=1})}}])})})},t.prototype.SortStart=function(e){document.querySelector(".active .menu-list").classList.add("sorting")},t.prototype.SortEnd=function(e){var t,i,a=document.querySelector(".active .menu-list"),o=(a.classList.remove("sorting"),e.from.classList.contains("list-all")&&e.to.classList.contains("list-active")&&document.querySelectorAll('.inactive .list-group-item[data-pageid="'+e.item.dataset.pageid+'"]').length&&document.querySelector('.inactive .list-group-item[data-pageid="'+e.item.dataset.pageid+'"]').remove(),e.from.classList.contains("list-active")&&e.to.classList.contains("list-all")&&((t=document.querySelectorAll('.active .list-group-item[data-pageid="'+e.item.dataset.pageid+'"]').length)&&e.item.remove(),i=document.querySelectorAll('.inactive .list-group-item[data-pageid="'+e.item.dataset.pageid+'"]').length,t||i||document.querySelector(".inactive .menu-list").appendChild(e.item)),e.from.classList.contains("list-active")&&e.to.classList.contains("list-inactive")&&document.querySelectorAll('.active .list-group-item[data-pageid="'+e.item.dataset.pageid+'"]').length&&e.item.remove(),e.from.classList.contains("list-inactive")&&e.to.classList.contains("list-all")&&document.querySelector(".inactive .menu-list").appendChild(e.item),e.from.classList.contains("list-all")&&e.to.classList.contains("list-inactive")&&e.item.remove(),[]);for(const l of a.children){var n=[];for(const s of l.querySelectorAll(".list-group-item"))n.push({id:s.dataset.pageid});o.push({id:l.dataset.pageid,children:n})}document.querySelector('input[name="menujson"]').value=JSON.stringify(o)},{init:function(){e.debug("mod_website/editmenu: initializing"),(new t).main()}}});