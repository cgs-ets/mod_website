define(["core/log","core/ajax"],function(t,o){"use strict";function i(){}return i.prototype.main=function(){for(var i=this,t=document.querySelectorAll(".nested-sortable.list-move"),e=0;e<t.length;e++)new Sortable(t[e],{group:{name:"nestedmenu",pull:!0},animation:150,fallbackOnBody:!0,swapThreshold:.65,ghostClass:"reordering",onStart:i.SortStart,onEnd:i.SortEnd});for(var a=document.querySelectorAll(".nested-sortable.list-clone"),e=0;e<a.length;e++)new Sortable(a[e],{group:{name:"nestedmenu",pull:"clone"},animation:150,fallbackOnBody:!0,swapThreshold:.65,ghostClass:"reordering",onStart:i.SortStart,onEnd:i.SortEnd});document.querySelectorAll(".visibility-visible").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),o.call([{methodname:"mod_website_apicontrol",args:{action:"page_visibility",data:JSON.stringify({pageid:e.dataset.pageid,hidden:1})}}]),document.querySelectorAll('.list-group-item[data-pageid="'+e.dataset.pageid+'"]').forEach(t=>{t.dataset.hidden=1})})}),document.querySelectorAll(".visibility-hidden").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),o.call([{methodname:"mod_website_apicontrol",args:{action:"page_visibility",data:JSON.stringify({pageid:e.dataset.pageid,hidden:0})}}]),document.querySelectorAll('.list-group-item[data-pageid="'+e.dataset.pageid+'"]').forEach(t=>{t.dataset.hidden=0})})}),document.querySelectorAll(".promote-to-homepage").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),o.call([{methodname:"mod_website_apicontrol",args:{action:"promotetohome",data:e.dataset.pageid},done:function(t){document.querySelectorAll('.list-group-item[data-ishomepage="1"]').forEach(t=>{t.dataset.ishomepage=0}),document.querySelectorAll('.list-group-item[data-pageid="'+e.dataset.pageid+'"]').forEach(t=>{t.dataset.ishomepage=1})}}])})}),document.querySelectorAll(".target").forEach(t=>{t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();let e=t.currentTarget;for(var a=e.dataset.target;e&&e!==document;e=e.parentNode)if(e.classList.contains("list-group-item"))return e.dataset.target=a,i.regenerateAttributes(e),void i.regenerateJson()})})},i.prototype.setTarget=function(t,e){},i.prototype.SortStart=function(t){document.querySelector(".active .menu-list").classList.add("sorting")},i.prototype.SortEnd=function(t){var e,a;t.from.classList.contains("list-all")&&t.to.classList.contains("list-active")&&document.querySelectorAll('.inactive .list-group-item[data-pageid="'+t.item.dataset.pageid+'"]').length&&document.querySelector('.inactive .list-group-item[data-pageid="'+t.item.dataset.pageid+'"]').remove(),t.from.classList.contains("list-active")&&t.to.classList.contains("list-all")&&((e=document.querySelectorAll('.active .list-group-item[data-pageid="'+t.item.dataset.pageid+'"]').length)&&t.item.remove(),a=document.querySelectorAll('.inactive .list-group-item[data-pageid="'+t.item.dataset.pageid+'"]').length,e||a||document.querySelector(".inactive .menu-list").appendChild(t.item)),t.from.classList.contains("list-active")&&t.to.classList.contains("list-inactive")&&document.querySelectorAll('.active .list-group-item[data-pageid="'+t.item.dataset.pageid+'"]').length&&t.item.remove(),t.from.classList.contains("list-inactive")&&t.to.classList.contains("list-all")&&document.querySelector(".inactive .menu-list").appendChild(t.item),t.from.classList.contains("list-all")&&t.to.classList.contains("list-inactive")&&t.item.remove(),(new i).regenerateJson()},i.prototype.regenerateAttributes=function(t){let e={target:""};(e=t.dataset.attributes?JSON.parse(t.dataset.attributes):e).target=t.dataset.target,t.dataset.attributes=JSON.stringify(e)},i.prototype.regenerateJson=function(){var t=document.querySelector(".active .menu-list"),e=(t.classList.remove("sorting"),[]);for(const o of t.children){var a=[];for(const r of o.querySelectorAll(":scope > .list-group")[0].querySelectorAll(":scope > .list-group-item")){var i=[];for(const s of r.querySelectorAll(":scope > .list-group")[0].querySelectorAll(":scope > .list-group-item"))console.log("Pushing "+s.dataset.pageid+" into tier 3"),i.push({id:s.dataset.pageid,attributes:s.dataset.attributes});console.log("Pushing "+r.dataset.pageid+" into tier 2"),a.push({id:r.dataset.pageid,attributes:r.dataset.attributes,children:i})}console.log("Pushing "+o.dataset.pageid+" into top"),e.push({id:o.dataset.pageid,attributes:o.dataset.attributes,children:a})}document.querySelector('input[name="menujson"]').value=JSON.stringify(e)},{init:function(){t.debug("mod_website/editmenu: initializing"),(new i).main()}}});