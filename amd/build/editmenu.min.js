define(["core/log","core/ajax"],function(t,l){"use strict";function e(){}return e.prototype.main=function(){for(var t=this,e=document.querySelectorAll(".nested-sortable.list-move"),i=0;i<e.length;i++)new Sortable(e[i],{group:{name:"nestedmenu",pull:!0},animation:150,fallbackOnBody:!0,swapThreshold:.65,ghostClass:"reordering",onStart:t.SortStart,onEnd:t.SortEnd});for(var a=document.querySelectorAll(".nested-sortable.list-clone"),i=0;i<a.length;i++)new Sortable(a[i],{group:{name:"nestedmenu",pull:"clone"},animation:150,fallbackOnBody:!0,swapThreshold:.65,ghostClass:"reordering",onStart:t.SortStart,onEnd:t.SortEnd});let n=document.querySelector(".visibility-visible");n&&n.addEventListener("click",t=>{t.preventDefault(),l.call([{methodname:"mod_website_apicontrol",args:{action:"page_visibility",data:JSON.stringify({pageid:n.dataset.pageid,hidden:1})}}]),document.querySelectorAll('.list-group-item[data-pageid="'+n.dataset.pageid+'"]').forEach(t=>{t.dataset.hidden=1})});var o=document.querySelector(".visibility-hidden");o&&o.addEventListener("click",t=>{t.preventDefault(),l.call([{methodname:"mod_website_apicontrol",args:{action:"page_visibility",data:JSON.stringify({pageid:n.dataset.pageid,hidden:0})}}]),document.querySelectorAll('.list-group-item[data-pageid="'+n.dataset.pageid+'"]').forEach(t=>{t.dataset.hidden=0})})},e.prototype.SortStart=function(t){document.querySelector(".active .menu-list").classList.add("sorting")},e.prototype.SortEnd=function(t){var e,i,a=document.querySelector(".active .menu-list"),n=(a.classList.remove("sorting"),t.from.classList.contains("list-all")&&t.to.classList.contains("list-active")&&document.querySelectorAll('.inactive .list-group-item[data-pageid="'+t.item.dataset.pageid+'"]').length&&document.querySelector('.inactive .list-group-item[data-pageid="'+t.item.dataset.pageid+'"]').remove(),t.from.classList.contains("list-active")&&t.to.classList.contains("list-all")&&((e=document.querySelectorAll('.active .list-group-item[data-pageid="'+t.item.dataset.pageid+'"]').length)&&t.item.remove(),i=document.querySelectorAll('.inactive .list-group-item[data-pageid="'+t.item.dataset.pageid+'"]').length,e||i||document.querySelector(".inactive .menu-list").appendChild(t.item)),t.from.classList.contains("list-active")&&t.to.classList.contains("list-inactive")&&document.querySelectorAll('.active .list-group-item[data-pageid="'+t.item.dataset.pageid+'"]').length&&t.item.remove(),t.from.classList.contains("list-inactive")&&t.to.classList.contains("list-all")&&document.querySelector(".inactive .menu-list").appendChild(t.item),t.from.classList.contains("list-all")&&t.to.classList.contains("list-inactive")&&t.item.remove(),[]);for(const l of a.children){var o=[];for(const s of l.querySelectorAll(".list-group-item"))o.push({id:s.dataset.pageid});n.push({id:l.dataset.pageid,children:o})}document.querySelector('input[name="menujson"]').value=JSON.stringify(n)},{init:function(){t.debug("mod_website/editmenu: initializing"),(new e).main()}}});