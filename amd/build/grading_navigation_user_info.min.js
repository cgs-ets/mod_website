define(["jquery","core/notification","core/ajax","core/templates"],function(s,o,a,d){function e(e){this._regionSelector=e,this._region=s(e),this._userCache=[],'[data-region="user-info"]'==e&&(this._userid=s('[data-region="user-info"]').data("userid"),this._refreshUserInfo("e",this._userid),this._refreshUserSelector()),s(document).on("user-changed",this._refreshUserInfo.bind(this))}return e.prototype._regionSelector=null,e.prototype._userCache=null,e.prototype._region=null,e.prototype._lastUserId=0,e.prototype._userid=0,e.prototype._getWebsiteId=function(){return this._region.attr("data-websiteid")},e.prototype._refreshUserSelector=function(){s(`select.custom-select option[value='${this._userid}']`).attr("selected","selected")},e.prototype._refreshUserInfo=function(e,n){var r=s.Deferred();this._region.attr("data-userid",n),this._lastUserId!=n&&(this._lastUserId=n,d.render("mod_website/loading",{}).done(function(e,t){var i;this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,e,t),this._region.fadeIn("fast")}.bind(this)),0==n?d.render("mod_website/grading_navigation_no_users",{}).done(function(e,t){n==this._lastUserId&&this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,e,t),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(o.exception):(void 0!==this._userCache[n]?r.resolve(this._userCache[n]):(i=this._getWebsiteId(),a.call([{methodname:"mod_website_get_participant",args:{userid:n,websiteid:i}}])[0].done(function(e){e.hasOwnProperty("id")?(this._userCache[n]=e,r.resolve(this._userCache[n])):r.reject("No users")}.bind(this)).fail(o.exception)),r.done(function(e){e.courseid=s('[data-region="grading-navigation-panel"]').attr("data-courseid"),e.user&&(e.identity=e.user.email,e.user.profileimageurl&&(e.profileimageurl=e.user.profileimageurl)),d.render("mod_website/grading_navigation_user_summary",e).done(function(e,t){n==this._lastUserId&&this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,e,t),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(o.exception)}.bind(this)).fail(function(){d.render("mod_website/grading_navigation_no_users",{}).done(function(e,t){this._region.fadeOut("fast",function(){d.replaceNodeContents(this._region,e,t),this._region.fadeIn("fast")}.bind(this))}.bind(this)).fail(o.exception)}.bind(this)))}.bind(this)).fail(o.exception))},e});